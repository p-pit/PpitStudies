<?php if ($statusCode == '200') : ?>

  <?php if (in_array($request, ['POST', 'DELETE'])) : ?>

<!-- Global message -->
<div id="message">
  <h5 class="alert alert-success my-3 text-center"><?php echo $this->translate('Your request has been registered', 'ppit-core', $context->getLocale()) ?></h5>
</div>

  <?php endif;?>

<?php elseif ($reasonPhrase == 'Duplicate') : ?>

<!-- Duplicate error -->
<div class="alert alert-danger my-3 text-center"><?php echo $this->translate('This record already exist', 'ppit-core', $context->getLocale()) ?></div>

<?php elseif ($reasonPhrase == 'Isolation') : ?>

<!-- Isolation error -->
<div class="alert alert-danger my-3 text-center"><?php echo $this->translate('The database has evolved in the meantime, please input again', 'ppit-core', $context->getLocale()) ?></div>

<?php elseif ($reasonPhrase == 'Consistency') : ?>

<!-- Consistency error -->
<div class="alert alert-danger my-3 text-center"><?php echo $this->translate('The data are not consistent', 'ppit-core', $context->getLocale()) ?></div>

<?php else : ?>

<!-- Programmation error -->
<div class="alert alert-danger my-3 text-center"><?php echo $reasonPhrase ?></div>

<?php endif;?>

<div class="alert alert-danger my-3 text-center note_evaluation_delete_confirmation"><?php echo $this->translate('Please confirm', 'ppit-core', $context->getLocale()) ?></div>

<form class="was-validated" id="note-evaluation-form">

<input type="hidden" id="update_time" value="<?php echo $content['update_time'] ?>" />

<?php if (in_array($request, ['POST', 'DELETE']) && $statusCode == '200') $isDisabled = true; else $isDisabled = false; ?>

<?php if (!in_array($request, ['POST', 'DELETE']) || !in_array($statusCode, ['200', '204', '201'])) : ?>
		    <div class="form-group row">
				<div class="col-sm-5">&nbsp;</div>
				<div class="col-sm-7">
					<input type="submit" class="note_evaluation_submit_button btn btn-warning" value="<?php echo $this->translate(($content['id']) ? 'Update' : 'Add', 'ppit-core', $context->getLocale()) ?>" />
  <?php if ($content['id'] && $content['type'] != 'report') : ?>
                    <button type="button" class="note_evaluation_delete_button btn btn-outline-primary" data-toggle="tooltip" title="<?php echo $this->translate('Delete', 'ppit-core', $context->getLocale()) ?>"><i class="fa fa-trash-alt"></i></button>
  <?php endif;?>
				</div>
			</div>
<?php endif;?>

<!-- Evaluation period -->
		<div class="form-group row">
			<label class="col-sm-5 col-form-label col-form-label-sm"><?php echo $context->localize($context->getConfig('student/property/school_period')['labels']) ?></label>
			<div class="col-sm-7">
				<select class="form-control form-control-sm update_input update_input_select" id="school_period" <?php if ($isDisabled || ($content['type'] == 'report')) echo 'disabled="disabled"'?> required>
					<option />
	<?php foreach ($context->getConfig('student/property/school_period')['modalities'] as $modalityId => $modality) : ?>
					<option value="<?php echo $modalityId ?>" <?php if ($modalityId == $content['note']['school_period']) echo 'selected="selected"' ?>><?php echo $context->localize($modality) ?></option>
	<?php endforeach;?>
				</select>
			</div>
		</div>

<!-- Teacher name -->
		<div class="form-group row">
			<label class="col-sm-5 col-form-label col-form-label-sm"><?php echo $this->translate('Teacher', 'ppit-studies', $context->getLocale()) ?></label>
			<div class="col-sm-7">
				<select class="form-control form-control-sm update_input update_input_select" id="teacher_id" <?php if ($isDisabled || !$context->hasROle('manager')) echo 'disabled="disabled"'?> required>
					<option />
	<?php foreach ($content['teachers'] as $teacher_id => $teacher) : ?>
					<option value="<?php echo $teacher_id ?>" <?php if ($teacher_id == $content['note']['teacher_id']) echo 'selected="selected"' ?>><?php echo $teacher['n_fn'] ?></option>
	<?php endforeach;?>
				</select>
			</div>
		</div>

<!-- Subject -->
		<div class="form-group row">
<?php if ($content['type'] != 'exam') : ?>
			<label class="col-sm-5 col-form-label col-form-label-sm"><?php echo $this->translate('Subject', 'ppit-studies', $context->getLocale()) ?></label>
			<div class="col-sm-7">
	    		<select class="form-control form-control-sm update_input update_input_select" id="subject" <?php if ($isDisabled || ($content['type'] == 'report' && $content['note']['subject'])) echo 'disabled="disabled"'?> required>
	    			<option value=""><-- <?php echo $this->translate('Please choose', 'ppit-core', $context->getLocale()) ?> --></option>
	<?php foreach ($content['config']['subjects'] as $subjectId => $subject) : ?>
		<?php
		$subject = $context->getConfig('student/property/school_subject')['modalities'][$subjectId];
		$caption = $context->localize($subject);
		?>
	    			<option value="<?php echo $subjectId ?>" <?php if ($content['note']['subject'] == $subjectId) echo 'selected="selected"' ?>><?php echo $caption ?></option>
	<?php endforeach;?>
                    <option value="global" <?php if ($content['note']['subject'] == 'global') echo 'selected="selected"' ?>><?php echo $this->translate('Opinion of staff meeting', 'ppit-studies', $context->getLocale()) ?></option>
	    		</select>
			</div>
<?php endif;?>
		</div>

<!-- Evaluation category -->
<?php if ($content['type'] != 'exam') : ?>
		<div class="form-group row">
			<input type="hidden" id="note_type" value="<?php echo $content['type'] ?>" />
  <?php if ($content['type'] != 'report') : ?>
			<label class="col-sm-5 col-form-label col-form-label-sm"><?php echo $context->localize($context->getConfig('student/property/evaluationCategory')['labels']) ?></label>
			<div class="col-sm-7">
	    		<select class="form-control form-control-sm update_input update_input_select" id="level" <?php if ($isDisabled) echo 'disabled="disabled"'?>>
	    			<option value=""><-- <?php echo $this->translate('Please choose', 'ppit-core', $context->getLocale()) ?> --></option>
  <?php foreach ($content['config']['categories'] as $categoryId => $category) : ?>
    <?php $caption = $context->localize($category); ?>
	    			<option value="<?php echo $categoryId ?>" <?php if ($content['note']['level'] == $categoryId) echo 'selected="selected"' ?>><?php echo $caption ?></option>
  <?php endforeach;?>
	    		</select>
			</div>
  <?php else : ?>
			<input type="hidden" id="level" />
  <?php endif;?>
		</div>
<?php else : ?>
<!-- Exam -->
		<div class="form-group row">
			<label class="col-sm-5 col-form-label col-form-label-sm"><?php echo $context->localize($context->getConfig('student/property/exam')['labels']) ?></label>
			<div class="col-sm-7">
	    		<select class="form-control form-control-sm update_input update_input_select" id="level" <?php if ($isDisabled) echo 'disabled="disabled"'?>>
	    			<option value=""><-- <?php echo $this->translate('Please choose', 'ppit-core', $context->getLocale()) ?> --></option>
  <?php foreach ($context->getConfig('student/property/exam')['modalities'] as $categoryId => $unused) : ?>
		<?php $caption = $context->localize($context->getConfig('student/property/evaluationCategory')['modalities'][$categoryId]); ?>
	    			<option value="<?php echo $categoryId ?>" <?php if ($content['level'] == $categoryId) echo 'selected="selected"' ?>><?php echo $caption ?></option>
  <?php endforeach;?>
	    		</select>
			</div>
		</div>
<?php endif;?>

<!-- Note date -->
<?php $noteDate = $content['note']['date'] ?>
		<div class="form-group row">
			<label class="col-sm-5 col-form-label col-form-label-sm"><?php echo $this->translate('Date', 'ppit-core', $context->getLocale()) ?></label>
			<div class="col-sm-7">
				<input class="form-control form-control-sm update_input update_input_date" id="date" value="<?php echo $context->decodeDate($noteDate) ?>" <?php if ($isDisabled) echo 'disabled="disabled"'?> required />
			</div>
			<div class="col-sm-12"><p class="help-block"></p></div>
		</div>

<!-- Reference value -->
<?php $reference_value = $content['note']['reference_value'] ?>
		<div class="form-group row">
			<label class="col-sm-5 col-form-label col-form-label-sm"><?php echo $this->translate('Reference value', 'ppit-studies', $context->getLocale()) ?></label>
			<div class="col-sm-7">
				<input class="form-control form-control-sm update_input update_input_number" id="reference_value" value="<?php echo $context->formatFloat($reference_value, 2) ?>" disabled="disabled" required />
			</div>
		</div>

<!-- Weight -->
<?php $weight = $content['note']['weight'] ?>
		<input type="hidden" id="weight" />
		<div class="form-group row">
			<label class="col-sm-5 col-form-label col-form-label-sm"><?php echo $this->translate('Weight', 'ppit-studies', $context->getLocale()) ?></label>
			<div class="col-sm-7">
				<input class="form-control form-control-sm update_input update_input_number" id="weight" value="<?php echo $context->formatFloat($weight, 2) ?>" <?php if ($isDisabled || $content['type'] == 'report') echo 'disabled="disabled"'?> required />
			</div>
		</div>

<?php foreach ($content['noteLinks'] as $noteLink) : ?>
<!-- Value -->
		<div class="form-group row">
			<label class="col-sm-5 col-form-label col-form-label-sm"><?php echo $noteLink['n_fn'] ?></label>
			<div class="col-sm-7">
  <?php if ($context->getConfig('note/property/value')['type'] == 'number') : ?>
				<input class="form-control form-control-sm update_input update_input_text" id="value-<?php echo $noteLink['account_id'] ?>" placeholder="<?php echo $this->translate((in_array($content['type'], ['report', 'exam'])) ? 'Average (computed if not input)' : 'Does not count in average if empty', 'ppit-studies', $context->getLocale()) ?>" <?php if ($noteLink['value'] !== null) echo 'value="'.$context->formatFloat($noteLink['value'], 2).'"' ?> <?php if ($isDisabled || $content['type'] == 'report') echo 'disabled="disabled"' ?> />
  <?php else : ?>
                <select class="form-control form-control-sm update_input update_input_select" id="value-<?php echo $noteLink['account_id'] ?>" placeholder="<?php echo $this->translate((in_array($content['type'], ['report', 'exam'])) ? 'Average (computed if not input)' : 'Does not count in average if empty', 'ppit-studies', $context->getLocale()) ?>" <?php if ($noteLink['value'] !== null) echo 'value="'.$context->formatFloat($noteLink['value'], 2).'"' ?> <?php if ($isDisabled || $content['type'] == 'report') echo 'disabled="disabled"' ?> <?php if ($isDisabled) echo 'disabled="disabled"'?>>
                  <option value=""></option>
  <?php foreach ($context->getConfig('note/property/value')['modalities'] as $modalityId => $modality) : ?>
                  <option value="<?php echo $modalityId ?>" <?php if ($noteLink['value'] == $modalityId) echo 'selected="selected"' ?>><?php echo $context->localize($modality) ?></option>
  <?php endforeach;?>
                </select>
  <?php endif;?>
			</div>
		</div>

<!-- Assessment -->
		<div class="form-group row">
			<label class="col-sm-5 col-form-label col-form-label-sm">&nbsp;</label>
			<div class="col-sm-7">
				<textarea class="form-control form-control-sm update_input update_input_textarea" id="assessment-<?php echo $noteLink['account_id'] ?>" <?php if ($isDisabled) echo 'disabled="disabled"'?> placeholder="<?php echo $this->translate('Assessment', 'ppit-studies', $context->getLocale()) ?>"><?php echo $noteLink['assessment'] ?></textarea>
			</div>
		</div>

<?php endforeach;?>

<?php if ($request == 'POST' && $statusCode == '200') : ?>
<!-- Class average -->
		<div class="form-group row">
			<label class="col-sm-5 col-form-label col-form-label-sm"><?php echo $this->translate('Class average', 'ppit-studies', $context->getLocale()) ?></label>
			<div class="col-sm-7">
				<input class="form-control form-control-sm" value="<?php echo $context->formatFloat($content['indicators']['average_note'], 2) ?>" disabled="disabled" />
			</div>
		</div>

<!-- Highest note -->
		<div class="form-group row">
			<label class="col-sm-5 col-form-label col-form-label-sm"><?php echo $this->translate('Highest note', 'ppit-studies', $context->getLocale()) ?></label>
			<div class="col-sm-7">
				<input class="form-control form-control-sm" value="<?php echo $context->formatFloat($content['indicators']['higher_note'], 2) ?>" disabled="disabled" />
			</div>
		</div>

<!-- Lowest note -->
		<div class="form-group row">
			<label class="col-sm-5 col-form-label col-form-label-sm"><?php echo $this->translate('Lowest note', 'ppit-studies', $context->getLocale()) ?></label>
			<div class="col-sm-7">
				<input class="form-control form-control-sm" value="<?php echo $context->formatFloat($content['indicators']['lower_note'], 2) ?>" disabled="disabled" />
			</div>
		</div>
<?php endif;?>

<!-- Class observations -->
		<div class="form-group row">
			<label class="col-sm-5 col-form-label col-form-label-sm"><?php echo $this->translate('Observations', 'ppit-core', $context->getLocale()) ?></label>
			<div class="col-sm-7">
				<textarea class="form-control form-control-sm" id="observations" <?php if ($isDisabled) echo 'disabled="disabled"'?> placeholder="<?php echo $this->translate('General observation (for the group)', 'ppit-studies', $context->getLocale()) ?>"><?php echo $content['note']['observations'] ?></textarea>
			</div>
		</div>

<?php if (!$isDisabled) : ?>

		    <div class="form-group row">
				<div class="col-sm-5">&nbsp;</div>
				<div class="col-sm-7">
					<input type="submit" class="note_evaluation_submit_button btn btn-warning" value="<?php echo $this->translate(($content['id']) ? 'Update' : 'Add', 'ppit-core', $context->getLocale()) ?>" />
  <?php if ($content['id']) : ?>
                    <button type="button" class="note_evaluation_delete_button btn btn-outline-primary" data-toggle="tooltip" title="<?php echo $this->translate('Delete', 'ppit-core', $context->getLocale()) ?>"><i class="fa fa-trash-alt"></i></button>
  <?php endif;?>
				</div>
			</div>
<?php endif;?>

	</form>
